#!/usr/local/bin/perl5.22.0
if ($< != 0) {
print "This script must be run with sudo.\n"; 
exit 0;
}
use Digest::SHA;
sub sha256sum {   
    my $file = shift;
    my $digest = "";
    eval {
      open(FILE, $file) or die "Can't find file $file\n";
	my $ctx = Digest::SHA->new;
	$ctx->addfile(*FILE);
	$digest = $ctx->hexdigest;
	close(FILE);
    };
    if ($@) {
	print $@;
	return ""; 
    }
    return $digest;
}
if (-e "/var/mobile/.gnupg/pubring.gpg") {
    chdir("/opt/compile");
    system("chmod 0755 gyro/ -R");
    my $directory = 'gyro/';
    opendir (DIR, $directory) or die $!;
    while (my $file = readdir(DIR)) {
    system("dpkg -b gyro/".$file." pods/".$file.".deb");
    }
    closedir(DIR);
    system("dpkg-scanpackages -m pods / > Packages");
    system("bzip2 -f Packages");
    system("rm Release.gpg");
    system("gpg -abs -o Release.gpg Release");
    exit 0;
} else {
    print("Missing GnuPG key!\n");
    print("You can generate one by typing gpg --gen-key.\n");
    exit 0;
}
